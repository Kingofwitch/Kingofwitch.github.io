"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[5744],{"75744":function(n,e,t){t.r(e),t.d(e,{"default":function(){return E}});var o=t(15671),a=t(43144),r=t(97326),i=t(60136),s=t(29388),c=t(4942),l=t(32238),u=t(84371),d=t(19042),p=t(67294),f=t(65403),h=t(67060),g=t(44541),m=t(74165),Z=t(15861),y=t(14751),S=function trim(n){return n.replace(/(^\s*)|(\s*$)/g,"")},x=t(69406),I=t(1413),L=function getSysEncodeSha(n){return h.Z.get("sys/encode/sha",(0,I.Z)({},n))},w=function mobileLogin(n){return h.Z.post("ent/mobile/login",(0,I.Z)({},n))},k=t(37762),b=function handleResponse(n,e){var t=function v(n,e){var t,o=(e||"").split("."),a=n,r=(0,k.Z)(o);try{for(r.s();!(t=r.n()).done;){var i=t.value;a=a&&a[i]}}catch(n){r.e(n)}finally{r.f()}return a},o=n.key,a=void 0===o?"":o,r=n.atom,i=void 0===r?{}:r,s=n.auths,c=void 0===s?[]:s,l=n.otherInfos,u=void 0===l?{}:l;g.Kn.setStoreageSync(g.ko.APP_KEY,a);var d=t(i,"entId")||"",p=t(i,"staffId")||"",f=t(i,"entAccountId")||"",h=t(i,"mobilePhone")||"",m=t(i,"headerPicUrl")||"",Z=t(i,"status")||"",y=t(i,"opChannelLevel")||"",S=t(i,"displayName")||"",x=t(u,"roleId")||"",I=t(u,"storageId")||"",L={"brandId":d,"storageId":I,"storageName":t(u,"storageName")||"","storeId":I,"userId":f,"mobilePhone":h,"headerPicUrl":m,"status":Z,"opChannelLevel":y,"staffId":p,"realName":S,"roleId":x,"channelId":t(u,"channelId")||"","isTempEnt":"true"===t(u,"isTempEnt"),"ext":{"atom":i,"auths":c,"otherInfos":u}};g.Kn.setStoreageSync(g.ko.USER_INFO,L),e(L)},j=t(85893),C=function(n){(0,i.Z)(StaffLogin,n);var e=(0,s.Z)(StaffLogin);function StaffLogin(){var n;(0,o.Z)(this,StaffLogin);for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return n=e.call.apply(e,[this].concat(a)),(0,c.Z)((0,r.Z)(n),"state",{"phone":"","password":"","brandId":""}),(0,c.Z)((0,r.Z)(n),"vertify",(function(){var e=n.state,t=e.phone,o=e.password,a=e.brandId;return!!(t&&o&&a)||((0,u.CF)({"title":"手机号、密码或品牌号为空","icon":"none"}),!1)})),(0,c.Z)((0,r.Z)(n),"handleLogin",(0,Z.Z)((0,m.Z)().mark((function _callee(){var e,t,o,a,r,i,s,c,l;return(0,m.Z)().wrap((function _callee$(d){for(;;)switch(d.prev=d.next){case 0:if(n.vertify()){d.next=2;break}return d.abrupt("return",!1);case 2:return e=n.state,t=e.phone,o=e.password,a=e.brandId,r=n.props.handleSuccess,(0,u.QP)(),i=L({"plainText":S(t)}),s=L({"plainText":S(o)}),d.next=9,Promise.all([i,s]);case 9:c=d.sent,l={"entId":S(a),"username":c[0].resultObject,"password":c[1].resultObject,"sysCode":"wholesale-mini","sysVersion":"1.0.0","clientType":"qywx","clientId":"wholesale-mini"},w(l).then((function(n){(0,u.Zk)(),b(n.resultObject,(function(n){x.Z.getUserExInfo(),r()}))})).catch((function(e){n.handleError(e)}));case 12:case"end":return d.stop()}}),_callee)})))),(0,c.Z)((0,r.Z)(n),"handleError",(function(n){(0,u.CF)({"title":n.exceptionMessage||"".concat(n),"icon":"none"})})),(0,c.Z)((0,r.Z)(n),"handlePwd",(function(){(0,d.T8)({"url":"/pages/login/resetPwd"})})),(0,c.Z)((0,r.Z)(n),"handleCodeLogin",(function(){(0,d.T8)({"url":"/pages/login/codeLogin"})})),n}return(0,a.Z)(StaffLogin,[{"key":"componentWillMount","value":function componentWillMount(){}},{"key":"componentDidMount","value":function componentDidMount(){}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"render","value":function render(){var n=this,e=this.state,t=e.phone,o=e.password,a=e.brandId;return(0,j.jsxs)(f.G7,{"className":"wrap","children":[(0,j.jsx)(y.Z,{"name":"phone","type":"text","placeholder":"请输入手机号/工号","value":t,"onInput":function onInput(e){var t=e.detail;return n.setState({"phone":t.value})}}),(0,j.jsx)(y.Z,{"name":"password","placeholder":"请输入密码","password":!0,"value":o,"onInput":function onInput(e){var t=e.detail;return n.setState({"password":t.value})}}),(0,j.jsx)(y.Z,{"name":"brandId","type":"number","placeholder":"请输入品牌号","value":a,"onInput":function onInput(e){var t=e.detail;return n.setState({"brandId":t.value})}}),(0,j.jsx)(f.zx,{"className":"bottom","type":"primary","onClick":this.handleLogin,"children":"登录"}),(0,j.jsxs)(f.G7,{"className":"bot","children":[(0,j.jsx)(f.G7,{"className":"item","onClick":this.handlePwd,"children":"忘记密码"}),(0,j.jsx)(f.G7,{"className":"item","onClick":this.handleCodeLogin,"children":"验证码登录"})]})]})}}]),StaffLogin}(p.Component),P=C,E=function(n){(0,i.Z)(Login,n);var e=(0,s.Z)(Login);function Login(){var n;(0,o.Z)(this,Login);for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return n=e.call.apply(e,[this].concat(a)),(0,c.Z)((0,r.Z)(n),"state",{"error":!1}),(0,c.Z)((0,r.Z)(n),"handleError",(function(n){(0,u.CF)({"title":n.exceptionMessage||"".concat(n),"icon":"none"})})),(0,c.Z)((0,r.Z)(n),"login",(function(){l.default.qy.login({"success":function success(e){e.code&&h.Z.get("wechat/miniappqywx/dj_qywx_xcx_login",{"xcxCode":e.code,"xcxType":"pfpos"},!1,!1).then((function(e){b(e.resultObject,(function(){n.updateLoginStatus()}))})).catch((function(){g.Kn.getStoreageSync(g.ko.APP_KEY)?n.updateLoginStatus():n.setState({"error":!0})}))},"fail":function fail(){g.Kn.getStoreageSync(g.ko.APP_KEY)?n.updateLoginStatus():n.setState({"error":!0})}})})),(0,c.Z)((0,r.Z)(n),"updateLoginStatus",(function(){(0,d.MR)({"url":"/pages/index/home/index"})})),(0,c.Z)((0,r.Z)(n),"handleSuccess",(function(){(0,u.Zk)(),n.updateLoginStatus()})),n}return(0,a.Z)(Login,[{"key":"componentWillMount","value":function componentWillMount(){this.login()}},{"key":"componentDidMount","value":function componentDidMount(){l.default.eventCenter.on("loginSuccess",this.updateLoginStatus)}},{"key":"componentWillUnmount","value":function componentWillUnmount(){l.default.eventCenter.off("loginSuccess",this.updateLoginStatus)}},{"key":"render","value":function render(){var n=this.state.error;return(0,j.jsx)(f.G7,{"className":"container","children":n?(0,j.jsx)(P,{"handleSuccess":this.handleSuccess}):(0,j.jsx)(f.G7,{})})}}]),Login}(p.Component)}}]);